{"title":"Doing GIS with Python","markdown":{"yaml":{"title":"Doing GIS with Python","format":{"html":{"code-fold":false}},"jupyter":"python3","keep-ipynb":true},"headingText":"Start a Python Project","containsRefs":false,"markdown":"\n\n\nImport the packages needed\n\n```{python}\n# Packages for handling files\nimport os\nimport zipfile\nimport shutil\n# Packages for reading and plotting data\nimport pandas as pd\nimport geopandas as gpd\nimport matplotlib.pyplot as plt\n\n```\n\n## Import the point data from github\n\n```{python}\nPID_Metadata = pd.read_csv('https://raw.githubusercontent.com/Police-Involved-Deaths-CA/Data/main/MostRecentUpdate/PID_locations_Metadata.csv')\n\nprint('Metadata')\nprint(PID_Metadata)\n\nPID_locations = pd.read_csv('https://raw.githubusercontent.com/Police-Involved-Deaths-CA/Data/main/MostRecentUpdate/PID_locations.csv')\n\nprint('\\nData Preview')\nprint(PID_locations.head())\n\nPID_locations.to_csv('Data/temp_files/PID_locations.csv')\n\n```\n\n## Import the Census Data\n\nExtract a .zipfile of census data downloaded from simply analytics\n\n* Read the metadata\n\n```{python}\nBC_Census_Data = 'SimplyAnalytics_Shapefiles_2023-02-02_23_07_59_7fa10dab487cee919a8d7e30ddf85ff3'\n\nwith zipfile.ZipFile('Data/'+BC_Census_Data+'.zip','r') as BCD:\n  print('.zipfile contains:')\n  print (BCD.namelist())\n  BCD.extractall('Data/temp_files/')\n\nprint('\\n Varible Names:')\n\nwith open('Data/temp_files/variable_names.txt') as var_name:\n  print(var_name.read())\n\n```\n## Read the Shapefile\n\n* Rename the columns\n* Change the projection\n* Calculate the new columns\n* Plot a map\n\n```{python}\n# Read Data\nBC_subDivs = gpd.read_file('Data/temp_files/'+BC_Census_Data+'.shp')\n\n# Rename Columns\nBC_subDivs = BC_subDivs.rename(columns = {\n  'VALUE0':'Pop_Indigenous',\n  'VALUE1':'Pop_Total',\n  'VALUE2':'Pop_Visible_Minority'\n})\n\n# Project to BC Albers\nBC_subDivs = BC_subDivs.to_crs(3005)\n\n# Calculate White and Non-White Population Totals\nBC_subDivs['Pop_NonWhite'] = BC_subDivs[['Pop_Indigenous','Pop_Visible_Minority']].sum(axis=1)\nBC_subDivs['Pop_White'] = BC_subDivs['Pop_Total'] - BC_subDivs['Pop_NonWhite']\n\n# Make a Map\nfig,ax=plt.subplots(figsize=(6,6))\nBC_subDivs.plot(column='Pop_Total',ax=ax,edgecolor='k',legend=True)\nax.set_title('Population by BC Sub-Divison 2022')\n\n```\n\n\n## Saving Data\n\nLets save the data and also create a .zip file so the data can be downloaded more easily.\n\n```{python}\n# Shapefile is a more complex format often used in desktop GIS.  We're saving to a temp folder because we will then zip the data for easier download\nBC_subDivs.to_file('Data/temp_files/BC_subDivs_2022.shp')\n\n# Save the .shp to a .zip for easier download\nfilepath = 'Data/Workshop_Data.zip'\n\n# Delete old .zip file *if it exists*\ntry:\n  os.unlink(filepath)\nexcept:\n  pass\n\nwith zipfile.ZipFile(filepath, 'a') as zipf:\n    source_path = 'Data/temp_files/'\n    source_name = 'BC_subDivs_2022'\n    destination_name = 'BC_subDivs_2022'\n    # Add the BC_subDivs_2022.shp\n    for tag in ['.shp','.dbf','.prj','.shx']:\n      zipf.write(source_path+source_name+tag, destination_name+tag)\n\n    # Add the deaths data as well\n    source_path = 'Data/PID_locations.csv'\n    destination = 'PID_locations.csv'\n    zipf.write(source_path, destination)\n\n# Delete data in temp_files\nfor root, dirs, files in os.walk('Data/temp_files'):\n    for f in files:\n      if f != '.gitignore':\n        os.unlink(os.path.join(root, f))\n\n```"},"formats":{"html":{"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":true,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"engine":"jupyter"},"render":{"keep-tex":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":false,"code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[]},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","css":["styles.css"],"toc":true,"output-file":"GIS_With_Python.html"},"language":{},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.2.313","theme":"cosmo","title":"Doing GIS with Python","jupyter":"python3"},"extensions":{"book":{"multiFile":true}}}}}